<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>panos_upgrade_assurance.utils &mdash; PanOS Upgrade Assurance 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            PanOS Upgrade Assurance
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration_details.html">Configuration details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building_docs.html">Building documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PanOS Upgrade Assurance</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">panos_upgrade_assurance.utils</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for panos_upgrade_assurance.utils</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<div class="viewcode-block" id="UnknownParameterException"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.UnknownParameterException">[docs]</a><span class="k">class</span> <span class="nc">UnknownParameterException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used when one of the requested configuration parameters processed by :class:`.ConfigParser` is not a valid parameter.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="WrongDataTypeException"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.WrongDataTypeException">[docs]</a><span class="k">class</span> <span class="nc">WrongDataTypeException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used when a variable does not meet data type requirements.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="CheckType"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.CheckType">[docs]</a><span class="k">class</span> <span class="nc">CheckType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class mapping check configuration strings for commonly used variables.</span>

<span class="sd">    Readiness checks configuration passed to the :class:`.CheckFirewall` class is in a form of a list of strings. These strings are compared in several places to parse the configuration and set the proper checks. This class is used to avoid hardcoding these strings. It maps the actual configuration string to a variable that can be referenced in the code.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PANORAMA</span> <span class="o">=</span> <span class="s2">&quot;panorama&quot;</span>
    <span class="n">HA</span> <span class="o">=</span> <span class="s2">&quot;ha&quot;</span>
    <span class="n">NTP_SYNC</span> <span class="o">=</span> <span class="s2">&quot;ntp_sync&quot;</span>
    <span class="n">CANDIDATE_CONFIG</span> <span class="o">=</span> <span class="s2">&quot;candidate_config&quot;</span>
    <span class="n">EXPIRED_LICENSES</span> <span class="o">=</span> <span class="s2">&quot;expired_licenses&quot;</span>
    <span class="n">CONTENT_VERSION</span> <span class="o">=</span> <span class="s2">&quot;content_version&quot;</span>
    <span class="n">SESSION_EXIST</span> <span class="o">=</span> <span class="s2">&quot;session_exist&quot;</span>
    <span class="n">ARP_ENTRY_EXIST</span> <span class="o">=</span> <span class="s2">&quot;arp_entry_exist&quot;</span>
    <span class="n">IPSEC_TUNNEL_STATUS</span> <span class="o">=</span> <span class="s2">&quot;ip_sec_tunnel_status&quot;</span>
    <span class="n">FREE_DISK_SPACE</span> <span class="o">=</span> <span class="s2">&quot;free_disk_space&quot;</span>
    <span class="n">MP_DP_CLOCK_SYNC</span> <span class="o">=</span> <span class="s2">&quot;planes_clock_sync&quot;</span></div>

<div class="viewcode-block" id="SnapType"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.SnapType">[docs]</a><span class="k">class</span> <span class="nc">SnapType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class mapping the snapshot configuration strings to the commonly used variables.</span>

<span class="sd">    Snapshot configuration passed to the :class:`.CheckFirewall` class is in a form of a list of strings. These strings are compared in several places to parse the configuration and set proper snapshots.</span>
<span class="sd">    This class is used to avoid hardcoding these strings. It maps the actual configuration string to a variable that can be referenced in the code.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">NICS</span> <span class="o">=</span> <span class="s2">&quot;nics&quot;</span>
    <span class="n">ROUTES</span> <span class="o">=</span> <span class="s2">&quot;routes&quot;</span>
    <span class="n">LICENSE</span> <span class="o">=</span> <span class="s2">&quot;license&quot;</span>
    <span class="n">ARP_TABLE</span> <span class="o">=</span> <span class="s2">&quot;arp_table&quot;</span>
    <span class="n">CONTENT_VERSION</span> <span class="o">=</span> <span class="s2">&quot;content_version&quot;</span>
    <span class="n">SESSION_STATS</span> <span class="o">=</span> <span class="s2">&quot;session_stats&quot;</span>
    <span class="n">IPSEC_TUNNELS</span> <span class="o">=</span> <span class="s2">&quot;ip_sec_tunnels&quot;</span></div>

<div class="viewcode-block" id="CheckStatus"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.CheckStatus">[docs]</a><span class="k">class</span> <span class="nc">CheckStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class containing possible statuses for the check results.</span>

<span class="sd">    Its main purpose is to extend the simple ``True/False`` logic in a way that would provide more details/explanation in case a check fails. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">SUCCESS</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">FAIL</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ERROR</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">SKIPPED</span> <span class="o">=</span> <span class="mi">3</span></div>

<div class="viewcode-block" id="CheckResult"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.CheckResult">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CheckResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class representing the readiness check results.</span>

<span class="sd">    It provides two types of information:</span>

<span class="sd">        * ``status`` which represents information about the check outcome,</span>
<span class="sd">        * ``reason`` a reason behind the particular outcome, this comes in handy when a check fails.</span>

<span class="sd">    Most of the :class:`.CheckFirewall` methods use this class to store the return values, but mostly internally. The :meth:`.CheckFirewall.run_readiness_checks` method translates this class into the python primitives: ``str`` and ``bool``.</span>
<span class="sd">    </span>
<span class="sd">    :ivar status: Holds the status of a check.</span>
<span class="sd">    :type status: :class:`.CheckStatus`</span>
<span class="sd">    :ivar reason: Holds a reason explaining why a check fails. Provides no value if the check is successful. </span>
<span class="sd">    :type reason: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">CheckStatus</span> <span class="o">=</span> <span class="n">CheckStatus</span><span class="o">.</span><span class="n">FAIL</span>
    <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<div class="viewcode-block" id="CheckResult.__str__"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.CheckResult.__str__">[docs]</a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Class&#39; string representation.</span>

<span class="sd">        :return: A string combined from the ``self.status`` and ``self.reason`` variables. Provides a human readable representation of the class. Perfect to provide a reason for a particular check outcome.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">] </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s1">&#39;</span></div>

<div class="viewcode-block" id="CheckResult.__bool__"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.CheckResult.__bool__">[docs]</a>    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Class&#39; boolean representation.</span>

<span class="sd">        :return: A boolean value interpreting the value of the current ``state``: </span>

<span class="sd">            * ``True`` when ``status`` is :attr:`.CheckStatus.SUCCESS`,</span>
<span class="sd">            * ``False`` otherwise.</span>

<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">CheckStatus</span><span class="o">.</span><span class="n">SUCCESS</span> <span class="k">else</span> <span class="kc">False</span></div></div>

<div class="viewcode-block" id="ConfigParser"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.ConfigParser">[docs]</a><span class="k">class</span> <span class="nc">ConfigParser</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class responsible for parsing the provided configuration.</span>
<span class="sd">    </span>
<span class="sd">    This class is universal, meaning it parses configuration provided as the list of strings or dictionaries and verifies it against the list of valid configuration items. </span>
<span class="sd">    There are no hardcoded items against which the configuration is checked.</span>

<span class="sd">    It assumes and understands the following _`dialect`:</span>

<span class="sd">        * all configuration elements are case-sensitive,</span>
<span class="sd">        * if an element is ``str``, it is the name of an element,</span>
<span class="sd">        * if an element is ``dict``, the key is treated as the name of the element and the value is simply a configuration for this element,</span>
<span class="sd">        * the ``all`` item is equal to all items from the valid configuration elements,</span>
<span class="sd">        * an empty list is the same as the list containing only the ``all`` item,</span>
<span class="sd">        * excluding elements are supported by prefixing an item with an exclamation mark, for example, ``&#39;!config&#39;`` will skip the ``&#39;config&#39;`` element.</span>
<span class="sd">        </span>
<span class="sd">            These elements are called ``not-elements``. They are useful when combined with ``all``.</span>
<span class="sd">            For example: a list of: ``[&#39;all&#39;, &#39;!tcp&#39;]`` or simply ``[&#39;!tcp&#39;]`` would take all valid elements except for ``tcp``.</span>
<span class="sd">            </span>
<span class="sd">            Having that said:</span>

<span class="sd">        * a list containing only ``not-elements`` is treated as if ``&#39;all&#39;`` would have been specified explicitly,</span>
<span class="sd">        * order does not matter,</span>
<span class="sd">        * you can override elements implicitly specified with ``all``. This means that:</span>
<span class="sd">        </span>
<span class="sd">            * when:</span>
<span class="sd">        </span>
<span class="sd">                * the following list is passed:</span>

<span class="sd">                    ::</span>

<span class="sd">                        [</span>
<span class="sd">                            &#39;all&#39;, </span>
<span class="sd">                            { &#39;content_version&#39;: {</span>
<span class="sd">                                &#39;version&#39;: &#39;1234-5678&#39;}</span>
<span class="sd">                            }</span>
<span class="sd">                        ]</span>
<span class="sd">                    </span>
<span class="sd">                *  ``content_version`` is a valid element</span>
<span class="sd">            </span>
<span class="sd">            * then:</span>
<span class="sd">                </span>
<span class="sd">                * ``all`` is expanded to all valid elements but</span>
<span class="sd">                * ``content_version`` is skipped during expansion (since an explicit definition for it is already available).</span>

<span class="sd">    :ivar _requested_config_names: Contains only element names of the requested configuration (see `dialect`_ above). When no requested configuration is passed (implicit ``&#39;all&#39;``, see `dialect`_), this is equal to ``self.valid_elements``.</span>
<span class="sd">    :type _requested_config_names: set</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ConfigParser.__init__"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.ConfigParser.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valid_elements</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">requested_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ConfigParser constructor.</span>

<span class="sd">        Introduces some initial verification logic:</span>

<span class="sd">            * ``valid_elements`` is converted to ``set`` - this way we get rid of all duplicates,</span>
<span class="sd">            * if ``requested_config`` is ``None`` we immediately treat it as if ``all``  was passed implicitly (see `dialect`_) - it&#39;s expanded to ``valid_elements``</span>
<span class="sd">            * ``_requested_config_names`` is introduced as ``requested_config`` stripped of any element configurations. Additionally, we do verification if elements of this variable match ``valid_elements``. An exception is thrown if not.</span>

<span class="sd">        :param valid_elements: Valid elements against which we check the requested config.</span>
<span class="sd">        :type: iterable</span>
<span class="sd">        :param requested_config: (defaults to ``None``) A list of requested configuration items with an optional configuration.</span>
<span class="sd">        :type requested_config: list, optional</span>
<span class="sd">        :raises UnknownParameterException: An exception is raised when a requested configuration element is not one of the valid elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">valid_elements</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">requested_config</span><span class="p">:</span>    <span class="c1"># if not None or not empty list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">requested_config</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">requested_config</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_requested_config_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">_extract_element_name</span><span class="p">(</span><span class="n">config_keyword</span><span class="p">)</span> <span class="k">for</span> <span class="n">config_keyword</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requested_config</span> <span class="p">])</span>
            <span class="k">for</span> <span class="n">config_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requested_config_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_element_included</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">config_name</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">UnknownParameterException</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unknown configuration parameter passed: </span><span class="si">{</span><span class="n">config_name</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_requested_config_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">valid_elements</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">requested_config</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">valid_elements</span><span class="p">)</span>  <span class="c1"># Meaning &#39;all&#39; valid tests</span></div>

<div class="viewcode-block" id="ConfigParser._is_element_included"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.ConfigParser._is_element_included">[docs]</a>    <span class="k">def</span> <span class="nf">_is_element_included</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method verifying if a config element is a correct (supported) value.</span>

<span class="sd">        This method can also handle ``not-elements`` (see `dialect`_).</span>

<span class="sd">        :meta private:</span>
<span class="sd">        :param element: The config element to verify. This can be a ``not-element``.</span>

<span class="sd">            This parameter is verified against ``self.valid_elements`` ``set``. Key word ``&#39;all&#39;`` is also accepted.</span>
<span class="sd">        :type element: str</span>
<span class="sd">        :return: ``True`` if the value is correct, ``False`` otherwise.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_elements</span> <span class="ow">or</span> <span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_elements</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">element</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">and</span> <span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requested_config</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ConfigParser._extract_element_name"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.ConfigParser._extract_element_name">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_extract_element_name</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Static method that extracts the name from a config element.</span>

<span class="sd">        If a config element is a string, the actual config element is returned. For elements of a dictionary type, the 1\ :sup:`st` key is returned.</span>

<span class="sd">        :meta private:</span>
<span class="sd">        :param config: A config element to provide a name for.</span>
<span class="sd">        :type config: str,dict</span>
<span class="sd">        :raises WrongDataTypeException: Thrown when config does not meet requirements.</span>
<span class="sd">        :return: The config element name.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">config</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">WrongDataTypeException</span><span class="p">(</span>
                    <span class="s1">&#39;Dict provided as config definition has incorrect format, it is supposed to have only one key {key:[]}&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">WrongDataTypeException</span><span class="p">(</span><span class="s1">&#39;Config definition is neither string or dict&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ConfigParser._expand_all"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.ConfigParser._expand_all">[docs]</a>    <span class="k">def</span> <span class="nf">_expand_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Expand key word ``&#39;all&#39;`` to  ``self.valid_elements``.</span>
<span class="sd">        </span>
<span class="sd">        During expansion, elements from ``self.valid_elements`` which are already available in ``self.requested_config`` are skipped.</span>
<span class="sd">        This way we do not introduce duplicates for elements that were provided explicitly. </span>

<span class="sd">        :meta private:</span>
<span class="sd">        :return: None, as this method directly operates on ``self.requested_config``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pure_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span>
            <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requested_config_names</span> <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requested_config</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_elements</span> <span class="o">-</span> <span class="n">pure_names</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requested_config</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ConfigParser.prepare_config"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.ConfigParser.prepare_config">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">dict</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the input config and return a machine-usable configuration.</span>

<span class="sd">        The parsed configuration retains element types. This means that an element of a dictionary type will remain a dictionary in the parsed config.</span>

<span class="sd">        This method handles most of the `dialect`_&#39;s logic.</span>

<span class="sd">        :return: The parsed configuration.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span> <span class="p">(</span><span class="n">config_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">config_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requested_config_names</span><span class="p">)</span> <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">requested_config</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;all&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requested_config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_expand_all</span><span class="p">()</span>

        <span class="n">final_configs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">config_element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requested_config</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">_extract_element_name</span><span class="p">(</span><span class="n">config_element</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">):</span>
                <span class="n">final_configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config_element</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">final_configs</span></div></div>


<div class="viewcode-block" id="interpret_yes_no"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.interpret_yes_no">[docs]</a><span class="k">def</span> <span class="nf">interpret_yes_no</span><span class="p">(</span><span class="n">boolstr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Interpret ``yes``/``no`` as booleans.</span>
<span class="sd">        </span>
<span class="sd">        :param boolstr: ``yes`` or ``no``, a typical device response for simple boolean-like queries.</span>
<span class="sd">        :type boolstr: str</span>
<span class="sd">        :raises WrongDataTypeException: An exception is raised when ``boolstr`` is neither ``yes`` or ``no``.</span>
<span class="sd">        :return: ``True`` for *yes*, ``False`` for *no*.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">boolstr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">WrongDataTypeException</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot interpret following string as boolean: </span><span class="si">{</span><span class="n">boolstr</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">boolstr</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span> <span class="k">else</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="printer"><a class="viewcode-back" href="../../api.html#panos_upgrade_assurance.utils.printer">[docs]</a><span class="k">def</span> <span class="nf">printer</span><span class="p">(</span><span class="n">report</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">indent_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print reports in human friendly format.</span>

<span class="sd">    :param report: Dict with reports from tests.</span>
<span class="sd">    :type report: dict</span>
<span class="sd">    :param indent_level: Indentation level.</span>
<span class="sd">    :type indent_level: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">delim</span> <span class="o">=</span> <span class="s1">&#39;   |&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;passed&#39;</span> <span class="ow">in</span> <span class="n">report</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">delim</span><span class="o">*</span><span class="n">indent_level</span><span class="si">}</span><span class="s1"> passed: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;passed&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;passed&#39;</span><span class="p">]:</span>
            <span class="k">return</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">report</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;passed&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">delim</span><span class="o">*</span><span class="n">indent_level</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">delim</span><span class="o">*</span><span class="p">(</span><span class="n">indent_level</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1">- </span><span class="si">{</span><span class="n">element</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">delim</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">indent_level</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>
                <span class="n">printer</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">indent_level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">delim</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">indent_level</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Palo Alto Networks.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>